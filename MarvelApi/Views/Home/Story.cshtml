@{
    ViewBag.Title = "Story";
}

<h2>Story</h2>

<div ng-app>
    <div ng-controller="StoryCtrl">
        <div id="storyText">
            <div ng-repeat="ln in storyText">
                {{ln}} 
            </div>
        </div>
        
        <div class="form-inline" role="form">
            <div class="form-group">
                <input type="text" class="form-control" id="command" ng-model="user.command">
                <button class="btn btn-default" ng-click="receiveCommand()">Send</button>
            </div>
        </div>

    </div>
</div>

<script>
    function StoryCtrl($scope, $http) {
        $scope.storyText = [];
        $scope.room = {};
        $scope.storyText.push(["Can you help me find some comics"]);

        $scope.sendCommand = function(output) {
            $scope.storyText.push(output);
        };

        $scope.receiveCommand = function () {
            switch ($scope.user.command) {
                case 'N':
                    var roomId = $scope.room.Neighbors[$scope.user.command];
                    setRoom(roomId);
                    return;
                default:
                    $scope.sendCommand('What you talking about, player');
            }
        };

        var roomRequest = $http.get("/api/room");
        roomRequest.success(function(data) {
            $scope.room = data;
        });

        function setRoom(roomId) {
            var roomRequest = $http.get("/api/room?roomId=" + roomId);
            roomRequest.success(function(data) {
                $scope.room = data;
                $scope.sendCommand($scope.room.Description);
            });
        }
                
    }

</script>